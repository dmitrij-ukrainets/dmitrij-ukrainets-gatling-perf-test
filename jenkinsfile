pipeline {
    agent any
    stages {
    stage ("Set M2_HOME variable"){
    steps {bat 'set M2_HOME = c:\\my_utils\\apache-maven-3.8.4\\'}
    }
    stage ("Set M2 variable"){
    steps {bat 'set M2 = c:\\my_utils\\apache-maven-3.8.4\\bin'}
    }
        stage("Build Maven") {
            steps {
                bat 'mvn -B clean package'
            }
        }
        stage("Run Gatling") {
        steps{int users = params.users}
        steps{int ramp = params.ramp;}
            steps {
                bat 'mvn clean gatling:test -Dusers=${users} -Dramp=${ramp}'
            }
            post {
                always {
                    gatlingArchive()
                }
            }
        }
    }
}